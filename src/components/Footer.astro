---
const pathname = Astro.url.pathname;
const cspNonce = Astro.locals.cspNonce;
---

<footer class="bottombar">
  <nav class="bottombar__nav" aria-label="Social">
    <a
      class="bottombar__link"
      href="https://github.com/t2ne"
      target="_blank"
      rel="noreferrer">github</a
    >
    <span class="bottombar__sep" aria-hidden="true">/</span>
    <a
      class="bottombar__link"
      href="https://gh.no-tone.com"
      target="_blank"
      rel="noreferrer">projects</a
    >
    <span class="bottombar__sep" aria-hidden="true">/</span>
    <button class="bottombar__link bottombar__contact" type="button"
      >contact</button
    >
  </nav>
</footer>

<script is:inline nonce={cspNonce}>
  (() => {
    const button = document.querySelector(".bottombar__contact");
    if (!button) return;

    const EMAIL = "msg@no-tone.com";
    let resetTimeout;

    const setLabel = (text) => {
      button.textContent = text;
    };

    setLabel("contact");

    button.addEventListener("click", async () => {
      clearTimeout(resetTimeout);
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(EMAIL);
        } else {
          const area = document.createElement("textarea");
          area.value = EMAIL;
          area.style.position = "fixed";
          area.style.opacity = "0";
          document.body.appendChild(area);
          area.select();
          document.execCommand("copy");
          document.body.removeChild(area);
        }
        setLabel("copied");
      } catch {
        setLabel("copy failed");
      }
      resetTimeout = setTimeout(() => setLabel("contact"), 1500);
    });
  })();
</script>
